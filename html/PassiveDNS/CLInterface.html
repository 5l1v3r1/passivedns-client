<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class PassiveDNS::CLInterface - RDoc Documentation</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-create_state">::create_state</a>
    
    <li ><a href="#method-c-get_letter_map">::get_letter_map</a>
    
    <li ><a href="#method-c-parse_command_line">::parse_command_line</a>
    
    <li ><a href="#method-c-pdnslookup">::pdnslookup</a>
    
    <li ><a href="#method-c-results_to_s">::results_to_s</a>
    
    <li ><a href="#method-c-run">::run</a>
    
    <li ><a href="#method-c-usage">::usage</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-PassiveDNS::CLInterface">
  <h1 id="class-PassiveDNS::CLInterface" class="class">
    class PassiveDNS::CLInterface
  </h1>

  <section class="description">
    
<p>Handles all the command-line parsing, state tracking, and dispatching
queries to the <a href="Client.html">PassiveDNS::Client</a> instance <a
href="CLInterface.html">CLInterface</a> is aliased by <a
href="CLI.html">CLI</a></p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-create_state" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_state</span><span
            class="method-args">(sqlitedb=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>create a state instance</p>
          
          

          
          <div class="method-source-code" id="create_state-source">
            <pre><span class="ruby-comment"># File lib/passivedns/client/cli.rb, line 241</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">create_state</span>(<span class="ruby-identifier">sqlitedb</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">state</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">sqlitedb</span>
    <span class="ruby-identifier">state</span> = <span class="ruby-constant">PassiveDNS</span><span class="ruby-operator">::</span><span class="ruby-constant">PDNSToolStateDB</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sqlitedb</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">state</span> = <span class="ruby-constant">PassiveDNS</span><span class="ruby-operator">::</span><span class="ruby-constant">PDNSToolState</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_letter_map" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_letter_map</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>generates a mapping between the option letter for each <a
href="../PassiveDNS.html">PassiveDNS</a> provider and the class</p>
          
          

          
          <div class="method-source-code" id="get_letter_map-source">
            <pre><span class="ruby-comment"># File lib/passivedns/client/cli.rb, line 12</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_letter_map</span>
  <span class="ruby-identifier">letter_map</span> = {}
  <span class="ruby-constant">PassiveDNS</span>.<span class="ruby-identifier">constants</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">const</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">PassiveDNS</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">const</span>).<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Class</span>) <span class="ruby-keyword">and</span> <span class="ruby-constant">PassiveDNS</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">const</span>).<span class="ruby-identifier">superclass</span> <span class="ruby-operator">==</span> <span class="ruby-constant">PassiveDNS</span><span class="ruby-operator">::</span><span class="ruby-constant">PassiveDB</span>
      <span class="ruby-identifier">letter_map</span>[<span class="ruby-constant">PassiveDNS</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">const</span>).<span class="ruby-identifier">option_letter</span>] = [<span class="ruby-constant">PassiveDNS</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">const</span>).<span class="ruby-identifier">name</span>, <span class="ruby-constant">PassiveDNS</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">const</span>).<span class="ruby-identifier">config_section_name</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">letter_map</span>      
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-parse_command_line" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_command_line</span><span
            class="method-args">(args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>parses the command line and yields an options hash</p>

<h3 id="method-c-parse_command_line-label-Default+Options">Default Options<span><a href="#method-c-parse_command_line-label-Default+Options">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-identifier">options</span> = {
  :<span class="ruby-identifier">pdnsdbs</span> =<span class="ruby-operator">&gt;</span> [],     <span class="ruby-comment"># passive dns providers to query</span>
  :<span class="ruby-identifier">format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;text&quot;</span>,  <span class="ruby-comment"># output format</span>
  :<span class="ruby-identifier">sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;\t&quot;</span>,       <span class="ruby-comment"># field separator for text format</span>
  :<span class="ruby-identifier">recursedepth</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-comment"># recursion depth</span>
  :<span class="ruby-identifier">wait</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,         <span class="ruby-comment"># wait period between recursions</span>
  :<span class="ruby-identifier">res</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,        <span class="ruby-comment"># unused.  I don&#39;t remember why this is here.</span>
  :<span class="ruby-identifier">debug</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>,    <span class="ruby-comment"># debug flag</span>
  :<span class="ruby-identifier">sqlitedb</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,   <span class="ruby-comment"># filename for maintaining state in an sqlite3 db</span>
  :<span class="ruby-identifier">limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,      <span class="ruby-comment"># number of results per provider per recursion</span>
  :<span class="ruby-identifier">help</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>      <span class="ruby-comment"># display the usage text</span>
}
</pre>
          
          

          
          <div class="method-source-code" id="parse_command_line-source">
            <pre><span class="ruby-comment"># File lib/passivedns/client/cli.rb, line 36</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">parse_command_line</span>(<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">origARGV</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">opts</span> = <span class="ruby-constant">GetoptLong</span>.<span class="ruby-identifier">new</span>(
    [ <span class="ruby-string">&#39;--help&#39;</span>, <span class="ruby-string">&#39;-h&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--debug&#39;</span>, <span class="ruby-string">&#39;-v&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--database&#39;</span>, <span class="ruby-string">&#39;-d&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">REQUIRED_ARGUMENT</span> ],
    
    [ <span class="ruby-string">&#39;--gdf&#39;</span>, <span class="ruby-string">&#39;-g&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--graphviz&#39;</span>, <span class="ruby-string">&#39;-z&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--graphml&#39;</span>, <span class="ruby-string">&#39;-m&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--csv&#39;</span>, <span class="ruby-string">&#39;-c&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--xml&#39;</span>, <span class="ruby-string">&#39;-x&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--yaml&#39;</span>, <span class="ruby-string">&#39;-y&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--json&#39;</span>, <span class="ruby-string">&#39;-j&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--text&#39;</span>, <span class="ruby-string">&#39;-t&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--sep&#39;</span>, <span class="ruby-string">&#39;-s&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">REQUIRED_ARGUMENT</span> ],
    
    [ <span class="ruby-string">&#39;--sqlite3&#39;</span>, <span class="ruby-string">&#39;-f&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">REQUIRED_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--recurse&#39;</span>, <span class="ruby-string">&#39;-r&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">REQUIRED_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--wait&#39;</span>, <span class="ruby-string">&#39;-w&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">REQUIRED_ARGUMENT</span> ],
    [ <span class="ruby-string">&#39;--limit&#39;</span>, <span class="ruby-string">&#39;-l&#39;</span>, <span class="ruby-constant">GetoptLong</span><span class="ruby-operator">::</span><span class="ruby-constant">REQUIRED_ARGUMENT</span> ]
  )

  <span class="ruby-identifier">letter_map</span> = <span class="ruby-identifier">get_letter_map</span>

  <span class="ruby-comment"># sets the default search methods</span>
  <span class="ruby-identifier">options</span> = {
    <span class="ruby-value">:pdnsdbs</span> =<span class="ruby-operator">&gt;</span> [],
    <span class="ruby-value">:format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;text&quot;</span>,
    <span class="ruby-value">:sep</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;\t&quot;</span>,
    <span class="ruby-value">:recursedepth</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>,
    <span class="ruby-value">:wait</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
    <span class="ruby-value">:res</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
    <span class="ruby-value">:debug</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>,
    <span class="ruby-value">:sqlitedb</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
    <span class="ruby-value">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
    <span class="ruby-value">:help</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  }

  <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">opt</span>, <span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">opt</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--help&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:help</span>] = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--debug&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:debug</span>] = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--database&#39;</span>
            <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">//</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;,&#39;</span>
          <span class="ruby-keyword">next</span>
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">letter_map</span>[<span class="ruby-identifier">c</span>]
          <span class="ruby-identifier">options</span>[<span class="ruby-value">:pdnsdbs</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">letter_map</span>[<span class="ruby-identifier">c</span>][<span class="ruby-value">1</span>]
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;ERROR: Unknown passive DNS database identifier: #{c}.&quot;</span>
          <span class="ruby-identifier">usage</span>(<span class="ruby-identifier">letter_map</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--gdf&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] = <span class="ruby-string">&#39;gdf&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--graphviz&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] = <span class="ruby-string">&#39;graphviz&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--graphml&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] = <span class="ruby-string">&#39;graphml&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--csv&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] = <span class="ruby-string">&#39;text&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:sep</span>] = <span class="ruby-string">&#39;,&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--yaml&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] = <span class="ruby-string">&#39;yaml&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--xml&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] = <span class="ruby-string">&#39;xml&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--json&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] = <span class="ruby-string">&#39;json&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--text&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] = <span class="ruby-string">&#39;text&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--sep&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:sep</span>] = <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--recurse&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:recursedepth</span>] = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_i</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--wait&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:wait</span>] = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_i</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--sqlite3&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:sqlitedb</span>] = <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;--limit&#39;</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:limit</span>] = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_i</span>
    <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">options</span>[<span class="ruby-value">:help</span>] = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">origARGV</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:pdnsdbs</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:pdnsdbs</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;bfk&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:pdnsdbs</span>].<span class="ruby-identifier">index</span>(<span class="ruby-string">&quot;bfk&quot;</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:recursedepth</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:wait</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-value">60</span>
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:wait</span>] = <span class="ruby-value">60</span>
    <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Enforcing a minimal 60 second wait when using BFK for recursive crawling&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:debug</span>]
    <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Using the following databases: #{options[:pdnsdbs].join(&quot;, &quot;)}&quot;</span>
    <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Recursions: #{options[:recursedepth]}, Wait time: #{options[:wait]}, Limit: #{options[:limit] or &#39;none&#39;}&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;text&quot;</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;csv&quot;</span>
            <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Output format: #{options[:format]} (sep=\&quot;#{options[:sep]}\&quot;)&quot;</span>
    <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Output format: #{options[:format]}&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;http_proxy&#39;</span>]
            <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Using proxy settings: http_proxy=#{ENV[&#39;http_proxy&#39;]}, https_proxy=#{ENV[&#39;https_proxy&#39;]}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  [<span class="ruby-identifier">options</span>, <span class="ruby-identifier">args</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-pdnslookup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">pdnslookup</span><span
            class="method-args">(state, pdnsclient, options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>performs a stateful, recursive (if desired) passive DNS lookup against all
specified providers</p>
          
          

          
          <div class="method-source-code" id="pdnslookup-source">
            <pre><span class="ruby-comment"># File lib/passivedns/client/cli.rb, line 190</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">pdnslookup</span>(<span class="ruby-identifier">state</span>, <span class="ruby-identifier">pdnsclient</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">recursedepth</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:recursedepth</span>]
  <span class="ruby-identifier">wait</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:wait</span>]
  <span class="ruby-identifier">debug</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:debug</span>]
  <span class="ruby-identifier">limit</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:limit</span>]
    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;pdnslookup: #{state.level} #{recursedepth}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">debug</span>
    <span class="ruby-identifier">level</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">while</span> <span class="ruby-identifier">level</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">recursedepth</span>
            <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;pdnslookup: #{level} &lt; #{recursedepth}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">debug</span>
            <span class="ruby-identifier">state</span>.<span class="ruby-identifier">each_query</span>(<span class="ruby-identifier">recursedepth</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
                    <span class="ruby-identifier">rv</span> = <span class="ruby-identifier">pdnsclient</span>.<span class="ruby-identifier">query</span>(<span class="ruby-identifier">q</span>,<span class="ruby-identifier">limit</span>)
                    <span class="ruby-keyword">if</span> <span class="ruby-identifier">rv</span>
                            <span class="ruby-identifier">rv</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
                                    <span class="ruby-keyword">if</span> [<span class="ruby-string">&quot;A&quot;</span>,<span class="ruby-string">&quot;AAAA&quot;</span>,<span class="ruby-string">&quot;NS&quot;</span>,<span class="ruby-string">&quot;CNAME&quot;</span>,<span class="ruby-string">&quot;PTR&quot;</span>].<span class="ruby-identifier">index</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">rrtype</span>)
                                            <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;pdnslookup: #{r.to_s}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">debug</span>
                                            <span class="ruby-identifier">state</span>.<span class="ruby-identifier">add_result</span>(<span class="ruby-identifier">r</span>)
                                    <span class="ruby-keyword">end</span>
                            <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">else</span>
                            <span class="ruby-identifier">state</span>.<span class="ruby-identifier">update_query</span>(<span class="ruby-identifier">rv</span>,<span class="ruby-string">&#39;failed&#39;</span>)
                    <span class="ruby-keyword">end</span>
                    <span class="ruby-identifier">sleep</span> <span class="ruby-identifier">wait</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">level</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">recursedepth</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-identifier">level</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">state</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-results_to_s" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">results_to_s</span><span
            class="method-args">(state,options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns a string transforming all the <a
href="PDNSResult.html">PassiveDNS::PDNSResult</a> stored in the state
object into text/xml/json/etc.</p>
          
          

          
          <div class="method-source-code" id="results_to_s-source">
            <pre><span class="ruby-comment"># File lib/passivedns/client/cli.rb, line 219</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">results_to_s</span>(<span class="ruby-identifier">state</span>,<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">format</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:format</span>]
  <span class="ruby-identifier">sep</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:sep</span>]
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">format</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;text&#39;</span>
            <span class="ruby-constant">PassiveDNS</span><span class="ruby-operator">::</span><span class="ruby-constant">PDNSResult</span>.<span class="ruby-identifier">members</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">sep</span>)<span class="ruby-operator">+</span><span class="ruby-string">&quot;\n&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">state</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">sep</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;yaml&#39;</span>
            <span class="ruby-identifier">state</span>.<span class="ruby-identifier">to_yaml</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;xml&#39;</span>
            <span class="ruby-identifier">state</span>.<span class="ruby-identifier">to_xml</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;json&#39;</span>
            <span class="ruby-identifier">state</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;gdf&#39;</span>
            <span class="ruby-identifier">state</span>.<span class="ruby-identifier">to_gdf</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;graphviz&#39;</span>
            <span class="ruby-identifier">state</span>.<span class="ruby-identifier">to_graphviz</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;graphml&#39;</span>
            <span class="ruby-identifier">state</span>.<span class="ruby-identifier">to_graphml</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-run" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run</span><span
            class="method-args">(args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>main method, takes command-line arguments and performs the desired queries
and outputs</p>
          
          

          
          <div class="method-source-code" id="run-source">
            <pre><span class="ruby-comment"># File lib/passivedns/client/cli.rb, line 251</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">options</span>, <span class="ruby-identifier">items</span> = <span class="ruby-identifier">parse_command_line</span>(<span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:help</span>]
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">usage</span>(<span class="ruby-identifier">get_letter_map</span>)
  <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:recursedepth</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>
                    <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;WARNING:  a recursedepth of &gt; 3 can be abusive, please reconsider: sleeping 60 seconds for sense to come to you (hint: hit CTRL-C)&quot;</span>
                    <span class="ruby-identifier">sleep</span> <span class="ruby-value">60</span>
            <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">state</span> = <span class="ruby-identifier">create_state</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:sqlitedb</span>])
  <span class="ruby-identifier">state</span>.<span class="ruby-identifier">debug</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:debug</span>]

  <span class="ruby-identifier">pdnsclient</span> = <span class="ruby-constant">PassiveDNS</span><span class="ruby-operator">::</span><span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:pdnsdbs</span>])
  <span class="ruby-identifier">pdnsclient</span>.<span class="ruby-identifier">debug</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:debug</span>]
  
  <span class="ruby-keyword">if</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">state</span>.<span class="ruby-identifier">add_query</span>(<span class="ruby-identifier">arg</span>,<span class="ruby-string">&#39;pending&#39;</span>,<span class="ruby-value">0</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">$stdin</span>.<span class="ruby-identifier">each_line</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">state</span>.<span class="ruby-identifier">add_query</span>(<span class="ruby-identifier">l</span>.<span class="ruby-identifier">chomp</span>,<span class="ruby-string">&#39;pending&#39;</span>,<span class="ruby-value">0</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">pdnslookup</span>(<span class="ruby-identifier">state</span>,<span class="ruby-identifier">pdnsclient</span>,<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">results_to_s</span>(<span class="ruby-identifier">state</span>,<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-usage" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">usage</span><span
            class="method-args">(letter_map)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns a string containing the usage information takes in a hash of letter
to passive dns providers</p>
          
          

          
          <div class="method-source-code" id="usage-source">
            <pre><span class="ruby-comment"># File lib/passivedns/client/cli.rb, line 154</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">usage</span>(<span class="ruby-identifier">letter_map</span>)
  <span class="ruby-identifier">databases</span> = <span class="ruby-identifier">letter_map</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-identifier">help_text</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;Usage: #{$0} [-d [#{databases}]] [-g|-v|-m|-c|-x|-y|-j|-t] [-os &lt;sep&gt;] [-f &lt;file&gt;] [-r#|-w#|-v] [-l &lt;count&gt;] &lt;ip|domain|cidr&gt;\n&quot;</span>
  <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Passive DNS Providers\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  -d#{databases} uses all of the available passive dns database\n&quot;</span>
  <span class="ruby-identifier">letter_map</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  -d#{l} use #{letter_map[l][0]}\n&quot;</span>
  <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -dvt uses VirusTotal and TCPIPUtils (for example)\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n&quot;</span>
  <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Output Formatting\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -g link-nodal GDF visualization definition\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -z link-nodal graphviz visualization definition\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -m link-nodal graphml visualization definition\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -c CSV\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -x XML\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -y YAML\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -j JSON\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -t ASCII text (default)\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -s &lt;sep&gt; specifies a field separator for text output, default is tab\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n&quot;</span>
  <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;State and Recursion\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -f[file] specifies a sqlite3 database used to read the current state - useful for large result sets and generating graphs of previous runs.\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  -r# specifies the levels of recursion to pull. **WARNING** This is quite taxing on the pDNS servers, so use judiciously (never more than 3 or so) or find yourself blocked!\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  -w# specifies the amount of time to wait, in seconds, between queries (Default: 0)\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -l &lt;count&gt; limits the number of records returned per passive dns database queried.\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n&quot;</span>
  <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Getting Help\n&quot;</span>
  <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -h hello there.  This option produces this helpful help information on how to access help.\n&quot;</span>
    <span class="ruby-identifier">help_text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;  -v debugging information\n&quot;</span>
  
    <span class="ruby-identifier">help_text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

