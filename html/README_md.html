<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>README - RDoc Documentation</title>

<link href="./fonts.css" rel="stylesheet">
<link href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/navigation.js"></script>
<script src="./js/search_index.js"></script>
<script src="./js/search.js"></script>
<script src="./js/searcher.js"></script>
<script src="./js/darkfish.js"></script>


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-PassiveDNS%3A%3AClient">PassiveDNS::Client</a>
    <li><a href="#label-Installation">Installation</a>
    <li><a href="#label-Configuration">Configuration</a>
    <li><a href="#label-Getting+Access">Getting Access</a>
    <li><a href="#label-Usage">Usage</a>
    <li><a href="#label-Writing+Your+Own+Database+Adaptor">Writing Your Own Database Adaptor</a>
    <li><a href="#label-Passive+DNS+-+Common+Output+Format">Passive DNS - Common Output Format</a>
    <li><a href="#label-Contributing">Contributing</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="./README_md.html">README</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page README.md">

<h1 id="label-PassiveDNS%3A%3AClient"><a href="PassiveDNS/Client.html">PassiveDNS::Client</a><span><a href="#label-PassiveDNS%3A%3AClient">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>This rubygem queries the following Passive DNS databases:</p>
<ul><li>
<p>BFK.de</p>
</li><li>
<p>CIRCL</p>
</li><li>
<p>DNSDB (FarSight)</p>
</li><li>
<p>Mnemonic</p>
</li><li>
<p>PassiveDNS.cn (Qihoo 360 Technology Co.,Ltd)</p>
</li><li>
<p>PassiveTotal</p>
</li><li>
<p>RiskIQ</p>
</li><li>
<p>TCPIPUtils</p>
</li><li>
<p>VirusTotal</p>
</li></ul>

<p>Passive DNS is a technique where IP to hostname mappings are made by
recording the answers of other people&#39;s queries.</p>

<p>There is a tool included, pdnstool, that wraps a lot of the functionality
that you would need.</p>

<p>Please note that use of any passive DNS database is subject to the terms of
use of that passive DNS database. Use of this script in violation of their
terms is strongly discouraged. Also, please do not add any obfuscation to
try to work around their terms of service. If you need special services,
ask the providers for help/permission. Remember, these passive DNS
operators are my friends. I don&#39;t want to have a row with them because
some jerk used this library to abuse them.</p>

<p>If you like this library, please buy the Passive DNS operators a round of
beers.</p>

<h2 id="label-Installation">Installation<span><a href="#label-Installation">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Add this line to your application&#39;s Gemfile:</p>

<pre>gem &#39;passivedns-client&#39;</pre>

<p>And then execute:</p>

<pre>$ bundle</pre>

<p>Or install it yourself as:</p>

<pre>$ gem install passivedns-client</pre>

<h2 id="label-Configuration">Configuration<span><a href="#label-Configuration">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>From version 2.0.0 on, all configuration keys for passive DNS providers are
in one configuration file. By default the location of the file is
$HOME/.passivedns-client . The syntax of this file is as follows:</p>

<pre>    [dnsdb]
    APIKEY = 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
    [cn360]
    API = http://some.web.address.for.their.api
    API_ID = a username that is given when you register
    API_KEY = a long and random password of sorts that is used along with the page request to generate a per page API key
    [tcpiputils]
    APIKEY = 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
    [virustotal]
    APIKEY = 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
    [mnemonic]
    APIKEY = 01234567890abcdef01234567890abcdef012345
    [passivetotal]
    APIKEY = 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
    [circl]
    USERNAME = circl_user
    PASSWORD = circl_pass
    [riskiq]
    API_TOKEN = 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
    API_PRIVATE_KEY = 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef</pre>

<p>CIRCL also can use and authorization token. In that case, you should drop
the USERNAME and PASSWORD options and change the section to something like
the following:</p>

<pre>    [circl]
    AUTH_TOKEN = 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef</pre>

<h2 id="label-Getting+Access">Getting Access<span><a href="#label-Getting+Access">&para;</a> <a href="#documentation">&uarr;</a></span></h2>
<ul><li>
<p>360.cn : <a href="http://www.passivedns.cn">www.passivedns.cn</a></p>
</li><li>
<p>BFK.de : No registration required, but please, please ready their usage
policy at <a
href="http://www.bfk.de/bfk_dnslogger.html">www.bfk.de/bfk_dnslogger.html</a></p>
</li><li>
<p>CIRCL : <a
href="https://www.circl.lu/services/passive-dns">www.circl.lu/services/passive-dns</a>/</p>
</li><li>
<p>DNSDB (Farsight Security) : <a
href="https://api.dnsdb.info">api.dnsdb.info</a>/</p>
</li><li>
<p>Mnemonic : mss .at. mnemonic.no</p>
</li><li>
<p>PassiveTotal : <a
href="https://www.passivetotal.org">www.passivetotal.org</a></p>
</li><li>
<p>TCPIPUtils : <a
href="http://www.tcpiputils.com/premium-access">www.tcpiputils.com/premium-access</a></p>
</li><li>
<p>VirusTotal : <a href="https://www.virustotal.com">www.virustotal.com</a></p>
</li></ul>

<h2 id="label-Usage">Usage<span><a href="#label-Usage">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<pre class="ruby">    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;passivedns/client&#39;</span>

    <span class="ruby-identifier">c</span> = <span class="ruby-constant">PassiveDNS</span><span class="ruby-operator">::</span><span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>([<span class="ruby-string">&#39;bfk&#39;</span>,<span class="ruby-string">&#39;dnsdb&#39;</span>]) <span class="ruby-comment"># providers: bfk, tcpiputils, certee, dnsdb, virustotal, passivedns.cn, mnemonic</span>
    <span class="ruby-identifier">results</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">query</span>(<span class="ruby-string">&quot;example.com&quot;</span>)
</pre>

<p>Or use the included toolâ€¦</p>

<pre>    Usage: bin/pdnstool [-d [3bcdmptv]] [-g|-v|-m|-c|-x|-y|-j|-t] [-os &lt;sep&gt;] [-f &lt;file&gt;] [-r#|-w#|-v] [-l &lt;count&gt;] &lt;ip|domain|cidr&gt;
    Passive DNS Providers  -d3bcdmptv uses all of the available passive dns database
      -d3 use 360.cn
      -db use BFK.de
      -dc use CIRCL
      -dd use DNSDB
      -dm use Mnemonic
      -dp use PassiveTotal
      -dr use RiskIQ
      -dt use TCPIPUtils
      -dv use VirusTotal
      -dvt uses VirusTotal and TCPIPUtils (for example)

    Output Formatting
      -g link-nodal GDF visualization definition
      -z link-nodal graphviz visualization definition
      -m link-nodal graphml visualization definition
      -c CSV
      -x XML
      -y YAML
      -j JSON
      -t ASCII text (default)
      -s &lt;sep&gt; specifies a field separator for text output, default is tab

    State and Recusion
      -f[file] specifies a sqlite3 database used to read the current state - useful for large result sets and generating graphs of previous runs.
      -r# specifies the levels of recursion to pull. **WARNING** This is quite taxing on the pDNS servers, so use judiciously (never more than 3 or so) or find yourself blocked!
      -w# specifies the amount of time to wait, in seconds, between queries (Default: 0)
      -l &lt;count&gt; limits the number of records returned per passive dns database queried.

    Getting Help
      -v debugging information</pre>

<h2 id="label-Writing+Your+Own+Database+Adaptor">Writing Your Own Database Adaptor<span><a href="#label-Writing+Your+Own+Database+Adaptor">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<pre class="ruby">    <span class="ruby-keyword">module</span> <span class="ruby-constant">PassiveDNS</span>
            <span class="ruby-keyword">class</span> <span class="ruby-constant">MyDatabaseAdaptor</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">PassiveDB</span>
                    <span class="ruby-comment"># override</span>
                <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>
                  <span class="ruby-string">&quot;MyPerfectDNS&quot;</span> <span class="ruby-comment"># short, proper label</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-comment">#override</span>
                <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">config_section_name</span>
                  <span class="ruby-string">&quot;perfect&quot;</span> <span class="ruby-comment"># very short label to use in the configuration file</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-comment">#override</span>
                <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">option_letter</span>
                  <span class="ruby-string">&quot;p&quot;</span> <span class="ruby-comment"># single letter to specify the option for the command line tool</span>
                <span class="ruby-keyword">end</span>

                <span class="ruby-identifier">attr_accessor</span> :<span class="ruby-identifier">debug</span>
                    <span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">options</span>={})
                      <span class="ruby-ivar">@debug</span> = <span class="ruby-identifier">options</span>[:<span class="ruby-identifier">debug</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
                      <span class="ruby-comment"># please include a way to change the base URL, HOST, etc., so that people can test</span>
                      <span class="ruby-comment"># against a test/alternate version of your service</span>
                  <span class="ruby-ivar">@base</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">&quot;URL&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;http://myperfectdns.example.com/pdns.cgi?query=&quot;</span>
                      <span class="ruby-ivar">@apikey</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">&quot;APIKEY&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">raise</span>(<span class="ruby-node">&quot;APIKEY option required for #{self.class}&quot;</span>)
                    <span class="ruby-keyword">end</span>

                    <span class="ruby-comment"># override</span>
                    <span class="ruby-keyword">def</span> <span class="ruby-identifier">lookup</span>(<span class="ruby-identifier">label</span>, <span class="ruby-identifier">limit</span>=<span class="ruby-keyword">nil</span>)
                            <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;DEBUG: #{self.class.name}.lookup(#{label})&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@debug</span>
                            <span class="ruby-identifier">recs</span> = []
                            <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-identifier">timeout</span>(<span class="ruby-value">240</span>) {
                                    <span class="ruby-identifier">t1</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
                                    <span class="ruby-comment"># TODO: your code goes here to fetch the data from your service</span>
                                    <span class="ruby-comment"># TODO: don&#39;t forget to impose the limit either during the fetch or during the parse phase</span>
                                    <span class="ruby-identifier">response_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">t1</span>
                                    <span class="ruby-comment"># TODO: parse your data and add PDNSResult objects to recs array</span>
                                    <span class="ruby-identifier">recs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">PDNSResult</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">response_time</span>, <span class="ruby-identifier">rrname</span> ,
                                            <span class="ruby-identifier">rdata</span>, <span class="ruby-identifier">rrtype</span>, <span class="ruby-identifier">ttl</span>, <span class="ruby-identifier">first_seen</span>, <span class="ruby-identifier">last_seen</span>, <span class="ruby-identifier">count</span> )
                            }
                            <span class="ruby-identifier">recs</span>
                    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span> <span class="ruby-comment"># using the implied &quot;begin/try&quot; from the beginning of the function</span>
                            <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{self.class.name} lookup timed out: #{label}&quot;</span>
                    <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Passive+DNS+-+Common+Output+Format">Passive DNS - Common Output Format<span><a href="#label-Passive+DNS+-+Common+Output+Format">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>There is an RFC, &lt;a href=&#39;<a
href="http://tools.ietf.org/html/draft-dulaunoy-kaplan-passive-dns-cof-01'>Passiveâ€œ>tools.ietf.org/html/draft-dulaunoy-kaplan-passive-dns-cof-01â€™>Passive</a>
DNS - Common Output Format&lt;/a&gt;, and a proof of concept
implementation, &lt;a href=&#39;<a
href="https://github.com/adulau/pdns-qof-server'>pdns-qof-server</a">github.com/adulau/pdns-qof-serverâ€™>pdns-qof-server</a</a>&gt;,
that describes a recommened JSON format for passive DNS data.
passivedns-client is very close to supporting it, but since I&#39;ve never
enteracted with a true implementation of this RFC, I can&#39;t attest that
I could correctly parse it. I think they way that they can encode multiple
results into one record would actually break what I have right now.</p>

<p>Right now, I&#39;m in a wait and see mode with how this progresses before I
start supporting yet another format or request that other providers start
to adhere to a common output format. If you have thoughts on the matter, I
would love to discuss.</p>

<h2 id="label-Contributing">Contributing<span><a href="#label-Contributing">&para;</a> <a href="#documentation">&uarr;</a></span></h2>
<ol><li>
<p>Fork it</p>
</li><li>
<p>Create your feature branch (<code>git checkout -b my-new-feature</code>)</p>
</li><li>
<p>Commit your changes (<code>git commit -am &#39;Add some
feature&#39;</code>)</p>
</li><li>
<p>Push to the branch (<code>git push origin my-new-feature</code>)</p>
</li><li>
<p>Create new Pull Request</p>
</li></ol>

<p>&lt;a href=â€˜mailto:github@chrisleephd[dot]us[stop here]xxx&#39;&gt;&lt;img
src=&#39;<a
href="http://chrisleephd.us/images/github-email.png?passivedns-client'></a">chrisleephd.us/images/github-email.png?passivedns-clientâ€™></a</a>&gt;</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

